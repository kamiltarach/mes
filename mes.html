<!DOCTYPE html>
<html>
<head>
  <title>Messenger</title>
  <link rel="stylesheet" href="mes.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <meta charset="utf-8">
  <link rel="icon" href="logo.png">
</head>
<body>
  <div id="header">
    <h1>Messenger</h1>
  </div>
  <section id="all-about-mess">
    <div id="recipient-container">
      <a href="#" class="recipient-link" data-recipient="Kamil Tarach">Kamil Tarach</a><br><br><br>
      <a href="#" class="recipient-link" data-recipient="Mścichuj Mickiewicz">Mścichuj Mickiewicz</a><br><br><br>
      <a href="#" class="recipient-link" data-recipient="Jacek Marek">Jacek Marek</a><br><br><br>
      <a href="#" class="recipient-link" data-recipient="Fiutek Słowacki">Fiutek Słowacki</a><br><br><br>
    </div>
    <div id="message-container"></div>
    <form class="message-form" action="mes.php" method="POST">
      <input type="text" id="message-input" name="message" placeholder="Wpisz wiadomość">
      <button type="submit" id="send-button">Wyślij</button>
    </form>
  </section>
  <script>
    // Funkcja do obsługi przycisku "Wyślij"
    function sendMessage() {
      var messageInput = document.getElementById("message-input");
      var recipientContainer = document.getElementById("recipient-container");
      var messageContainer = document.getElementById("message-container");

      // Pobieranie wybranego rozmówcy
      var recipient = recipientContainer.dataset.selectedRecipient;

      // Sprawdzanie, czy wybrano rozmówcę
      if (!recipient) {
        alert("Wybierz rozmówcę!");
        return;
      }

      // Tworzenie nowego elementu wiadomości
      var messageElement = document.createElement("div");
      messageElement.innerText = messageInput.value;

      // Dodawanie wiadomości do kontenera na początku
      messageContainer.insertBefore(messageElement, messageContainer.firstChild);

      // Czyszczenie pola tekstowego po wysłaniu wiadomości
      messageInput.value = "";

      // Wysłanie wiadomości do bazy danych
      sendMessageToDatabase(recipient, messageElement.innerText);
    }

    // Funkcja do wysyłania wiadomości do bazy danych
    function sendMessageToDatabase(recipient, message) {
      // Wykorzystaj AJAX, aby wysłać dane do skryptu PHP
      $.ajax({
        url: "mes.php",
        type: "POST",
        data: {
          recipient: recipient,
          message: message
        },
        success: function(response) {
          console.log(response);
        },
        error: function(xhr, status, error) {
          console.log("Błąd zapisu wiadomości: " + error);
        }
      });
    }

    // Obsługa kliknięcia na hiperłącze rozmówcy
    $(".recipient-link").click(function(e) {
      e.preventDefault(); // Zapobieganie domyślnej akcji kliknięcia

      // Usunięcie zaznaczenia ze wszystkich hiperłączy
      $(".recipient-link").removeClass("selected");

      // Zaznaczenie wybranego rozmówcy
      $(this).addClass("selected");

      // Zapisanie wybranego rozmówcy w atrybucie data-recipient kontenera
      var recipient = $(this).data("recipient");
      $("#recipient-container").attr("data-selected-recipient", recipient);
    });

    // Obsługa formularza
    $(".message-form").submit(function(e) {
      e.preventDefault(); // Zapobieganie domyślnej akcji formularza
      sendMessage();
    });

    // Funkcja do pobierania i wyświetlania wiadomości z bazy danych
    function fetchMessages() {
      var messageContainer = document.getElementById("message-container");

      // Wykorzystaj AJAX, aby pobrać wiadomości z serwera
      $.ajax({
        url: "fetch-messages.php", // Twój skrypt PHP do pobierania wiadomości
        type: "GET",
        success: function(response) {
          messageContainer.innerHTML = response;
        },
        error: function(xhr, status, error) {
          console.log("Błąd pobierania wiadomości: " + error);
        }
      });
    }

    // Wywołaj funkcję fetchMessages co 5 sekund
    setInterval(fetchMessages, 500);
  </script>
</body>
</html>
